var textOnImg;var nbInitials=3;var widthImageWrapper=0;var ihsElementPopin;var toneOnToneColorLabel="";var toneOnTone;var toneOnToneColor;var textOnImgShadowColor;var coordinateX,coordinateY;var fontSize;var selectorColorDefault=".hotstampingModal #hotStampingColor_1";var iHsStorage={};var textOnImgTop=0;var textOnImgLeft=0;var skuId="";var localStorageChanged=false;var colorCodeToneOnToneATG="BE8B76";var ftSize=0;var coordinateXinitial="";var coordinateYinitial="";var verticalUrl="",dotUrl="",initialsUrl="",dateUrl="",displayColorUrl="",goldUrl="",colorUrl="";var reset=false;var tagClickClass="";var alreadyLaunch=false;var currentColorCode="",currentColorName="",verticalDisplay=false,dotsDisplay=false,dateDisplay=false,goldDisplay=false,initialsText="";var INITIALS_SAVED="";function launchHotStamping(){if(textOnImg==null||(!hsDeactivate&&!alreadyLaunch)){buildElementTextOnImage();if(checkUrl()){updateReminderOnHsMenu();updateForm()}else{if($.jStorage.get(skuId)!=null){iHsStorage=JSON.parse($.jStorage.get(skuId));updateReminderOnHsMenu();updateForm()}else{handleDisplayingChangeButton()}}getShadeColor()}getAjax(true,"hotstampingPopin.jsp",handlehostampData,{skuId:skuId})}function handlehostampData(a){$("#hotStampingContentPopin").html(a).hide()}function buildElementTextOnImage(){textOnImg=$("<div></div>");for(var b=0;b<nbInitials;b++){var a='<span id="initialOnImg'+b+'"class="initialOnImg"></span>';textOnImg.append(a)}textOnImg.addClass("textOnImg")}function applyHeadingsLevels(){$(".hsPropertiesContent").find("div.engravingKindLabel").replaceWith("<h2 class='engravingKindLabel'>"+$(".engravingKindLabel").html()+"</h2>");$(".hsPropertiesContent").find("span.initialsLabel").replaceWith("<h2 class='initialsLabel'>"+$(".initialsLabel").html()+"</h2>");$(".hsPropertiesContent").find("span.colorLabel").replaceWith("<h2 class='colorLabel'>"+$(".colorLabel").html()+"</h2>");$(".hsPropertiesContent").find("div.hsDotsLabel").replaceWith("<h2 class='hsDotsLabel'>"+$(".hsDotsLabel").html()+"</h2>");$(".hsPropertiesContent").find("div.hsDisplayLabel").replaceWith("<h2 class='hsDisplayLabel'>"+$(".hsDisplayLabel").html()+"</h2>");$(".hsPropertiesContent").find("div.engravingFinishingLabel").replaceWith("<h2 class='engravingFinishingLabel'>"+$(".engravingFinishingLabel").html()+"</h2>")}function callbackAfterOpenHSModal(){ihsElementPopin=$(".hotstampingModal #hsImageWrapper");$(".hotstampingModal").parent().parent().addClass("blackWrapperHs");ihsElementPopin.append(textOnImg);applyHeadingsLevels();initIHSValue();tagManagementCloseButton();if(!localStorageChanged&&checkUrl()){updateHsDomValue()}else{if($.jStorage.get(skuId)==null||($.jStorage.get(skuId)=="{}")){$.jStorage.set(skuId,JSON.stringify(iHsStorage))}else{getHsValueFromLocalStorage()}}updateDotsDisplayButton();updateVerticalDisplayButton();updateEngravingKindButton();updateGoldFinishingButton();alreadyLaunch=true;setTimeout(calculateCoordinate,50);updateForm();setTimeout(currentPaletteClick,500);launchTimerCheckingLettersChanged();bindChangeEvent()}function currentPaletteClick(){$(".hotstampingModal .currentPaletteIhs").click(changeColorHandler)}function tagManagementCloseButton(){var a=$(".hotstampingModal .closeButton");a.addClass(tagClickClass);a.attr("id","hsCloseButton")}function checkUrl(){if(initialsUrl==""&&dateUrl==""){return false}getInitialsFromUrl();iHsStorage.color=displayColorUrl;iHsStorage.dots=(dotUrl=="true");iHsStorage.vertical=(verticalUrl=="true");iHsStorage.gold=(goldUrl=="true");iHsStorage.date=(dateUrl=="true");return true}function getInitialsFromUrl(){for(var a=0;a<nbInitials;a++){iHsStorage["initial"+a]=a<initialsUrl.length?initialsUrl.charAt(a):"";iHsStorage["date"+a]=a<dateUrl.length?dateUrl.charAt(a):""}}function handleDisplayingChangeButton(){if((!localStorageChanged&&checkUrl())||($.jStorage.get(skuId)!=null&&$.jStorage.get(skuId)!="{}"&&checkInitialsValueInLocalStorage())){$("#hsButtonBegin").addClass("hide");$("#hsButtonChange").removeClass("hide");$(".hsSummary").removeClass("hide");$(".hsItemCustomizedMessage").removeClass("hide");$(".hsCustomizeItemMessage").addClass("hide");product_data.product_hotstamped=1}else{$("#hsButtonChange").addClass("hide");$("#hsButtonBegin").removeClass("hide");$(".hsSummary").addClass("hide");$(".hsItemCustomizedMessage").addClass("hide");$(".hsCustomizeItemMessage").removeClass("hide");product_data.product_hotstamped=0}}function checkInitialsValueInLocalStorage(){for(var a=0;a<nbInitials;a++){if(dateDisplay){var b="date"}else{var b="initial"}if(iHsStorage[b+a]!=""){return true}}return false}function checkInitialsValue(){for(var a=0;a<nbInitials;a++){if(($(".hotstampingModal").find("#hs_initial_"+a)).val()!=""){return true}}return false}function checkDateValue(){for(var a=0;a<nbInitials;a++){if(($(".hotstampingModal").find("#engraving_date_"+a)).val()!=""){return true}}return false}function handleClosingHotstamping(){getHsValueFromLocalStorage();alreadyLaunch=false}function handleSavingHotstamping(){if(dateDisplay&&$('.engravingModal [id^="initialOnImg"]:not(:empty)').length<2){$(".engravingModal .datePrecisionMessage").addClass("error");return false}else{localStorageChanged=true;setHsValueInLocalStorage();updateForm();updateReminderOnHsMenu();$(".hotstampingModal").find(".closeButton").click();alreadyLaunch=false}}function updateReminderOnHsMenu(){var b="";var a="";if(iHsStorage.date){a=getDateValueWithDot(iHsStorage.date0+iHsStorage.date1+iHsStorage.date2)}if(a!=""){$(".hsSummaryDateValue").html(a);$(".hsSummaryDate").removeClass("hide");$(".hsSummaryLetters").addClass("hide")}if(iHsStorage.dots&&!iHsStorage.vertical){b=getInitialValueWithDot(iHsStorage.initial0+iHsStorage.initial1+iHsStorage.initial2)}else{b=iHsStorage.initial0+iHsStorage.initial1+iHsStorage.initial2}if(b!=""){$(".hsSummaryLettersValue").html(b);$(".hsSummaryLettersValue br").remove();$(".hsSummaryDate").addClass("hide");$(".hsSummaryLetters").removeClass("hide");currentColorCode=iHsStorage.color;currentColorName=$("#colorNameValueForJs [data-color="+currentColorCode+"]");$(".hsSummaryColorThumbnail title").attr("id","color_"+iHsStorage.color);$(".hsSummaryColorThumbnail rect").attr("fill",codeToHexa(iHsStorage.color));$(".hsSummaryColorName").html(currentColorName.attr("name-color"));verticalDisplay=iHsStorage.vertical;if(iHsStorage.vertical){$(".hsSummaryDisplayLettersValue").html($(".hsSummaryDisplayLettersValue").attr("data-display"));$(".hsSummaryDisplayLetters").removeClass("hide")}else{$(".hsSummaryDisplayLetters").addClass("hide")}}if(a!=""||b!=""){dotsDisplay=iHsStorage.dots;dateDisplay=iHsStorage.date;goldDisplay=iHsStorage.gold;if(iHsStorage.gold){$(".hsSummaryGoldThumbnail").removeClass("hide");$(".hsSummaryGoldValueTrue").removeClass("hide");$(".hsSummaryGoldValueFalse").addClass("hide")}else{$(".hsSummaryGoldThumbnail").addClass("hide");$(".hsSummaryGoldValueTrue").addClass("hide");$(".hsSummaryGoldValueFalse").removeClass("hide")}}handleDisplayingChangeButton()}function getInitialValueWithDot(c){var d="",b="";for(var a=0;a<c.length;a++){d+=c[a]}for(var a=0;a<d.length;a++){b+=d[a]+((a!=d.length-1)?".":"")}return b}function getDateValueWithDot(c){var a="";for(var b=0;b<c.length;b++){if(b%2==0){a+=c[b]+c[b+1];if(b!=c.length-2){a+="."}}}return a}function setHsValueInLocalStorage(){if(checkInitialsValue()){iHsStorage.color=$(".hotstampingModal .currentPaletteIhs").attr("data-color");iHsStorage.dots=dotsDisplay;iHsStorage.vertical=verticalDisplay;iHsStorage.gold=goldDisplay;iHsStorage.date=false}else{if(dateDisplay){iHsStorage.date=true;iHsStorage.dots=true;iHsStorage.gold=goldDisplay}else{iHsStorage.color="";iHsStorage.dots=false;iHsStorage.vertical=false;iHsStorage.gold=false;iHsStorage.date=false}}iHsStorage.initial0=$(".hotstampingModal #hs_initial_0").val();iHsStorage.initial1=$(".hotstampingModal #hs_initial_1").val();iHsStorage.initial2=$(".hotstampingModal #hs_initial_2").val();iHsStorage.date0=$(".hotstampingModal #engraving_date_0").val();iHsStorage.date1=$(".hotstampingModal #engraving_date_1").val();iHsStorage.date2=$(".hotstampingModal #engraving_date_2").val();$.jStorage.set(skuId,JSON.stringify(iHsStorage))}function getHsValueFromLocalStorage(){iHsStorage=JSON.parse($.jStorage.get(skuId));updateHsDomValue()}function updateHsDomValue(){$(".hotstampingModal #hs_initial_0").val(iHsStorage.initial0);$(".hotstampingModal #hs_initial_1").val(iHsStorage.initial1);$(".hotstampingModal #hs_initial_2").val(iHsStorage.initial2);$(".hotstampingModal #engraving_date_0").val(iHsStorage.date0);$(".hotstampingModal #engraving_date_1").val(iHsStorage.date1);$(".hotstampingModal #engraving_date_2").val(iHsStorage.date2);if(iHsStorage.color==""||iHsStorage.color==null){currentColorCode=$(selectorColorDefault).attr("data-color")}else{currentColorCode=iHsStorage.color}textOnImg.css("color",codeToHexa(currentColorCode));var a=$(".hotstampingModal [data-color="+currentColorCode+"]");if((currentColorCode!="")&&(a.length==0)){a=$(".hotstampingModal #noneColor")}addClassCurrentPalette(a);currentColorName=a.attr("name-color");$(".hotstampingModal #hotStampingColor").find(".colorName").html(currentColorName);verticalDisplay=iHsStorage.vertical;dotsDisplay=iHsStorage.dots;goldDisplay=iHsStorage.gold;dateDisplay=iHsStorage.date;setInitials();if(dotsDisplay||dateDisplay){addDot()}if(verticalDisplay){setVertical()}else{activateDotButton()}}function calculateCoordinate(){setFontSize();var b=ihsElementPopin.find("img").width();var a=ihsElementPopin.find("img").height();if(coordinateXinitial!=""){coordinateX=coordinateXinitial*b/widthImageWrapper;coordinateY=coordinateYinitial*a/widthImageWrapper;updatePositionDisplay()}}function compareColor(){return(currentColorCode==toneOnToneColor)?true:false}function initIHSValue(){currentColorCode=$(selectorColorDefault).attr("data-color");currentColorName=$(selectorColorDefault).attr("name-color");$(".hotstampingModal #hotStampingColor").find(".colorName").html(currentColorName);textOnImg.css("color",codeToHexa(currentColorCode))}function bindChangeEvent(){if(countInitials($(".hotstampingModal .initialsBox"))!==1){$(".hotstampingModal .withDots").click(addDotHandler)}else{$(".hotstampingModal .withDots").off("click");removeDotHandler()}if(dateDisplay){$(".hotstampingModal .withoutDots").off("click")}else{$(".hotstampingModal .withoutDots").click(removeDotHandler)}$(".hotstampingModal .verticalDisplay").click(verticalHandler);$(".hotstampingModal .horizontalDisplay").click(horizontalHandler);$(".hotstampingModal .engravingDate").click(engravingDateHandler);$(".hotstampingModal .engravingInitials").click(engravingInitialsHandler);$(".hotstampingModal .withFinishing").click(goldFinishingHandler);$(".hotstampingModal .withoutFinishing").click(noGoldFinishingHandler);var b=$(".hotstampingModal #hotStampingColor").find(".hotStampingColor");b.click(changeColorHandler);$(".hotstampingModal #hsReset").click(resetAllValue);for(var a=0;a<nbInitials;a++){if(a<nbInitials-1){bindLettersChanged(a,a+1)}else{bindLettersChanged(nbInitials-1,0)}}$(".hotstampingModal").find(".closeButton").click(handleClosingHotstamping);$(".hotstampingModal").find("#hsConfirm").click(handleSavingHotstamping)}function bindLettersChanged(c,a){var e=/^[A-Za-z]+$/;var d=/^[0-9][0-9]*$/;if(isIdevice){$(".hotstampingModal").find("#hs_initial_"+c).on("input",function(g){var f=$(this).val();if((f!="")&&!(e.test(f))){$(this).val("")}})}$(".hotstampingModal").find("#engraving_date_"+c).on("input",function(g){var f=$(this).val();if((f!="")&&!(d.test(f))){$(this).val("")}});var b=$(".hotstampingModal .initialsBox");($(".hotstampingModal").find("#hs_initial_"+c)).on("keyup change paste",function(){var f=$(this).val();if((f!="")&&(e.test(f))){textOnImg.find("#initialOnImg"+c).html(f)}else{textOnImg.find("#initialOnImg"+c).html("");$(this).val("")}if(countInitials(b)===1){removeDotHandler();$(".hotstampingModal .withDots").off("click")}else{$(".hotstampingModal .withDots").click(addDotHandler)}updateDisplay();fixMaxLength()});($(".hotstampingModal").find("#engraving_date_"+c)).on("keyup change paste",function(){var f=$(this).val();if((f!="")&&(d.test(f))){textOnImg.find("#initialOnImg"+c).html(f)}else{textOnImg.find("#initialOnImg"+c).html("");$(this).val("")}updateDotsDisplay();updatePositionDisplay()});($(".hotstampingModal").find("#engraving_date_"+c)).on("change",function(){var f=$(this).val();if((f.length==1)&&(d.test(f))){$(this).val("0"+f)}if($('.engravingModal [id^="initialOnImg"]:not(:empty)').length>1){$(".engravingModal .datePrecisionMessage").removeClass("error")}updateDotsDisplay();updatePositionDisplay()})}function countInitials(b){if(b.length===0){return false}var c=0,a=$('[id^="hs_initial_"]',b);a.each(function(d,e){if($(e).val()!==""){c++}});return c}function fixMaxLength(){var a=window.navigator.appVersion;a=a.toLowerCase();if(a.indexOf("android 4.1")>=0){var b={};$.each($(":text, textarea, :password"),function(){var d=$(this).attr("id"),c=$(this).attr("maxlength");if((typeof d!=="undefined")&&(typeof c!=="undefined")){b[d]=c;$(this).removeAttr("maxlength")}});$(":text, textarea, :password").bind("change keyup",function(){var e=$(this).attr("id"),c="";if(typeof e!=="undefined"&&b.hasOwnProperty(e)){c=b[e];var d=$(this).val();if(d.length>c){$(this).val(d.slice(d.length-c,d.length));setInitials()}}})}}function setInitials(){if(dateDisplay){var a="#engraving_date_"}else{var a="#hs_initial_"}for(var b=0;b<nbInitials;b++){textOnImg.find("#initialOnImg"+b).html($(".hotstampingModal "+a+""+b).val())}INITIALS_SAVED=getInitialsFromInputs(a)}function getInitialsFromInputs(a){var b="";for(var c=0;c<nbInitials;c++){b+=$(".hotstampingModal "+a+""+c).val()}return b}function addDot(){if(dotsDisplay||dateDisplay){if(dateDisplay){var e="#engraving_date_"}else{var e="#hs_initial_"}for(var f=0;f<nbInitials;f++){var a=f+1;var d=f+2;var c="#initialOnImg"+f;var b=$(".hotstampingModal "+e+""+f).val();if(a!=nbInitials){if(b!=""&&$(".hotstampingModal "+e+""+a).val()!=""){textOnImg.find(c).html(b+".")}else{if(b!=""&&$(".hotstampingModal "+e+""+d).val()!=""&&$(e+""+d).length!=0){textOnImg.find(c).html(b+".")}else{textOnImg.find(c).html(b)}}}else{textOnImg.find(c).html(b)}}}}function updateAltTextOnImg(){if(getInitialsText()==""){var a="Personalization preview "}else{var a="Personalization preview : "+$(".textOnImg").text()}textOnImg.prev("img").attr("alt",a)}function verticalMode(){if(verticalDisplay){for(var b=0;b<nbInitials-1;b++){var a=b+1;if($(".hotstampingModal #hs_initial_"+b).val()!=""){textOnImg.find("#initialOnImg"+b).html($(".hotstampingModal #hs_initial_"+b).val()+"<br>")}}}}function updateDisplay(){updateDotsDisplay();updateVerticalDisplay();updateColorDisplay();updatePositionDisplay()}function updatePositionDisplay(){setTextOnImgLeftAndTopPosition()}function updateDotsDisplay(){if(dotsDisplay||dateDisplay){addDot()}else{removeDots()}updateAltTextOnImg()}function addDotHandler(){dotsDisplay=true;updateDisplay();updateDotsDisplayButton()}function verticalHandler(){verticalDisplay=true;updateDisplay();updateVerticalDisplayButton()}function engravingDateHandler(){dateDisplay=true;updateDisplay();resetInputsValue("#hs_initial_");updateEngravingKindButton()}function engravingInitialsHandler(){dateDisplay=false;updateDisplay();resetInputsValue("#engraving_date_");updateEngravingKindButton()}function goldFinishingHandler(){goldDisplay=true;updateGoldFinishingButton()}function noGoldFinishingHandler(){goldDisplay=false;updateGoldFinishingButton()}function removeDotHandler(){dotsDisplay=false;updateDisplay();updateDotsDisplayButton()}function horizontalHandler(){verticalDisplay=false;updateDisplay();updateVerticalDisplayButton()}function updateVerticalDisplay(){if(verticalDisplay){setVertical()}else{removeVertical()}}function updateVerticalDisplayButton(){if(verticalDisplay){$(".hotstampingModal .verticalDisplay").attr("aria-pressed","true");$(".hotstampingModal .horizontalDisplay").attr("aria-pressed","false");$(".hotstampingModal .withDots").unbind("click").attr("aria-pressed","false");$(".hotstampingModal .withoutDots").unbind("click").attr("aria-pressed","true");$(".hotstampingModal .hsDotsButton .hsButtonList").addClass("hsButtonOpacity")}else{$(".hotstampingModal .verticalDisplay").attr("aria-pressed","false");$(".hotstampingModal .horizontalDisplay").attr("aria-pressed","true");activateDotButton()}}function updateEngravingKindButton(){if(dateDisplay){$(".hotstampingModal .engravingDate").attr("aria-pressed","true");$(".hotstampingModal .engravingInitials").attr("aria-pressed","false");$(".hotstampingModal .withDots").unbind("click").attr("aria-pressed","true");$(".hotstampingModal .withoutDots").unbind("click").attr("aria-pressed","false");$(".hotstampingModal .hsDotsButton .hsButtonList").addClass("hsButtonOpacity");$(".hotstampingModal .initialsWrapper").addClass("hide");$(".hotstampingModal .dateWrapper").removeClass("hide");$(".hotstampingModal .textOnImg").addClass("dateDisplay");$(".hotstampingModal .datePrecisionMessage").removeClass("hide error")}else{$(".hotstampingModal .engravingDate").attr("aria-pressed","false");$(".hotstampingModal .engravingInitials").attr("aria-pressed","true");$(".hotstampingModal .initialsWrapper").removeClass("hide");$(".hotstampingModal .dateWrapper").addClass("hide");$(".hotstampingModal .textOnImg").removeClass("dateDisplay");$(".hotstampingModal .datePrecisionMessage").addClass("hide");activateDotButton()}}function updateGoldFinishingButton(){if(goldDisplay){$(".textOnImg").addClass("gold");$(".hotstampingModal .withFinishing").attr("aria-pressed","true");$(".hotstampingModal .withoutFinishing").attr("aria-pressed","false")}else{$(".textOnImg").removeClass("gold");$(".hotstampingModal .withFinishing").attr("aria-pressed","false");$(".hotstampingModal .withoutFinishing").attr("aria-pressed","true")}}function activateDotButton(){$(".hotstampingModal .withDots").click(addDotHandler);$(".hotstampingModal .withoutDots").click(removeDotHandler);$(".hotstampingModal .hsDotsButton .hsButtonList").removeClass("hsButtonOpacity");updateDotsDisplayButton()}function updateDotsDisplayButton(){if(dotsDisplay){$(".hotstampingModal .withDots").attr("aria-pressed","true");$(".hotstampingModal .withoutDots").attr("aria-pressed","false")}else{$(".hotstampingModal .withDots").attr("aria-pressed","false");$(".hotstampingModal .withoutDots").attr("aria-pressed","true")}}function changeColorHandler(){if($(this).attr("id")=="hotStampingColor_0"){toneOnToneColorLabel=$(this).attr("name-color");currentColorCode=toneOnToneColor;currentColorName=toneOnToneColorLabel}else{currentColorCode=$(this).attr("data-color");currentColorName=$(this).attr("name-color")}addClassCurrentPalette($(this));updateDisplay()}function updateColorDisplay(){if(currentColorName==toneOnToneColorLabel){setShadowToTextOnImg()}else{clearShadowTextOnImg()}textOnImg.css("color",codeToHexa(currentColorCode));$(".hotstampingModal #hotStampingColor").find(".colorName").html(currentColorName)}function updateForm(){if(iHsStorage.color==""||iHsStorage.color==null){currentColorCode=$(selectorColorDefault).attr("data-color")}else{currentColorCode=iHsStorage.color}if(compareColor()){$("#colorHS").val(colorCodeToneOnToneATG)}else{$("#colorHS").val(currentColorCode)}$("#dotHS").val(verticalDisplay?false:dotsDisplay);$("#verticalHS").val(verticalDisplay);if(dateDisplay){$("#dotHS").val(true);$("#initialsHS").val("");$("#dateLibHS").val(getInitialsText())}else{$("#initialsHS").val(getInitialsText());$("#dateLibHS").val("");dateDisplay=false}$("#displayColorHS").val(currentColorCode);$("#finishGold").val(goldDisplay);updateReminderOnHsMenu()}function getInitialsText(){var a="";if($(".textOnImg").length>0){a=$(".textOnImg").text();if(!dateDisplay){a=a.replace(".","");a=a.replace(/\s/g,"");a=a.replace(".","")}}else{if(dateDisplay){a=$(".hsSummaryDateValue").text()}else{a=$(".hsSummaryLettersValue").text();a=a.replace(".","");a=a.replace(/\s/g,"");a=a.replace(".","")}}return a.toUpperCase()}function removeDots(){for(var a=0;a<nbInitials-1;a++){textOnImg.find("#initialOnImg"+a).html(($(".hotstampingModal #hs_initial_"+a)).val())}dotsDisplay=false}function setVertical(){$(".addDots").find(".addDotsLabel").addClass("disabled");$(".addDots").find("input").attr("disabled",true);verticalMode()}function removeVertical(){for(i=0;i<nbInitials;i++){textOnImg.find("#initialOnImg"+i+" br").remove()}addDot();verticalDisplay=false}function resetInputsValue(a){for(i=0;i<nbInitials;i++){$(".hotstampingModal "+a+""+i).val("");textOnImg.find("#initialOnImg"+i).html("")}}function resetAllValue(){for(i=0;i<nbInitials;i++){$(".hotstampingModal #engraving_date_"+i).val("");$(".hotstampingModal #hs_initial_"+i).val("");textOnImg.find("#initialOnImg"+i).html("")}removeVertical();removeDots();addClassCurrentPalette($(selectorColorDefault));clearShadowTextOnImg();currentColorCode=$(selectorColorDefault).attr("data-color");currentColorName=$(selectorColorDefault).attr("name-color");$(".hotstampingModal #hotStampingColor .colorName").html(currentColorName);textOnImg.css("color",codeToHexa(currentColorCode));verticalDisplay=false;dotsDisplay=false;goldDisplay=false;dateDisplay=false;updateVerticalDisplayButton();updateDotsDisplayButton();updateGoldFinishingButton();updateEngravingKindButton();$(".hsImageWrapper").not(":hidden").find("img").attr("alt","Personalization preview")}function setTextOnImgLeftAndTopPosition(){var f=ihsElementPopin.find("img").offset().top;var a=ihsElementPopin.offset().top;var l=ihsElementPopin.find("img").offset().left;var k=ihsElementPopin.offset().left;var h=$(".textOnImg").height()/2;var m=0;if(verticalDisplay||$(".textOnImg").width()/2>getWidthTextOnIHS()){m=$(".textOnImg").width()/2}else{if(dateDisplay){var d=0;for(i=0;i<3;i++){d+=$(".engravingModal #initialOnImg"+i).width();$(".engravingModal #initialOnImg"+i).css("left",-$(".engravingModal #initialOnImg"+i).width()/2)}m=$(".textOnImg").width();h=$(".textOnImg span").height()/2}else{m=getWidthTextOnIHS()}}textOnImgLeft=coordinateX+l-m-k;textOnImgTop=coordinateY+f-h-a;textOnImg.css("top",textOnImgTop+"px");textOnImg.css("left",textOnImgLeft+"px");if(dateDisplay){var e=$('.engravingModal [id^="initialOnImg"]:not(:empty)').length;var j='.engravingModal [id^="initialOnImg"]:not(:empty)';$('.engravingModal [id^="initialOnImg"]').removeClass("first2 last2 first3 last3");if(e>1){$(j+":first").addClass("first"+e);$(j+":last").addClass("last"+e)}var c=0.092;var b=0.185;if(RESPONSIVE_MANAGER.isAllSmallMode()){var g=window.matchMedia("(orientation: portrait)");if(g.matches){var b=0.265}else{var b=0.395}}$(".engravingModal .initialOnImg").css("transform","rotate(0deg)");$(".engravingModal .initialOnImg.first2").css("transform","rotate("+ftSize*c+"deg)");$(".engravingModal .initialOnImg.last2").css("transform","rotate(-"+ftSize*c+"deg)");$(".engravingModal .initialOnImg.first3").css("transform","rotate("+ftSize*b+"deg)");$(".engravingModal .initialOnImg.last3").css("transform","rotate(-"+ftSize*b+"deg)")}}function getWidthTextOnIHS(){var a=0;for(var b=0;b<nbInitials;b++){a+=$("#initialOnImg"+b).width()}return a/2}function addClassCurrentPalette(a){$(".hotstampingModal .hotStampingColor").removeClass("currentPaletteIhs");a.addClass("currentPaletteIhs")}function getRelativePath(a){return(CONFIGURATION.devMode?"/"+CONFIGURATION.MOBILE_CONTEXTE_ROOT:"")+a.replace(/^.*\/\/[^\/]+/,"")}function setFontSize(){var a=ihsElementPopin.find("img").width();ftSize=(fontSize*a)/widthImageWrapper;textOnImg.css("font-size",ftSize)}function codeToHexa(a){return"#"+a}function rgbToHexNoSharp(d,c,a){return componentToHex(d)+componentToHex(c)+componentToHex(a)}function componentToHex(b){var a=b.toString(16);return a.length==1?"0"+a:a}function setShadowToTextOnImg(){var a="-1px 0 "+textOnImgShadowColor+", 0 1px "+textOnImgShadowColor+", 1px 0 "+textOnImgShadowColor+", 0 -1px "+textOnImgShadowColor;$(".initialOnImg").css("text-shadow",a)}function clearShadowTextOnImg(){$(".initialOnImg").css("text-shadow","")}function getOriginalWidthOfImg(){var a=new Image;$(a).load(function(){widthImageWrapper=this.width;launchHotStamping()}).attr("src",$("#hsImageWrapper img").attr("src"))}function launchTimerCheckingLettersChanged(){if(!isAndroidTablet()){return}checkLettersChanged()}function checkLettersChanged(){if(getInitialsFromInputs()!=INITIALS_SAVED){setInitials();updatePositionDisplay()}setTimeout(checkLettersChanged,200)}function getShadeColor(){if(toneOnToneColor!=""){var a=hex2rgb(toneOnToneColor);textOnImgShadowColor=shadeColor(a,-10)}}function hex2rgb(e){var d=hexToR(e);var c=hexToG(e);var a=hexToB(e);return[d,c,a]}function cutHex(a){return(a.charAt(0)=="#")?a.substring(1,7):a}function hexToB(a){return parseInt((cutHex(a)).substring(4,6),16)}function hexToR(a){return parseInt((cutHex(a)).substring(0,2),16)}function hexToG(a){return parseInt((cutHex(a)).substring(2,4),16)}function shadeColor(a,f){var e=a[0];var d=a[1];var h=a[2];e=parseInt(e*(100+f)/100);d=parseInt(d*(100+f)/100);h=parseInt(h*(100+f)/100);e=(e<255)?e:255;d=(d<255)?d:255;h=(h<255)?h:255;var c=((e.toString(16).length==1)?"0"+e.toString(16):e.toString(16));var b=((d.toString(16).length==1)?"0"+d.toString(16):d.toString(16));var g=((h.toString(16).length==1)?"0"+h.toString(16):h.toString(16));return"#"+c+b+g}function toneOnToneColorDarker(){return colorLuminance(toneOnToneColor,-0.1)}function colorLuminance(e,a){var b="",f,d;if(e!=""){e=String(e).replace(/[^0-9a-f]/gi,"");if(e.length<6){e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]}a=a||0;for(d=0;d<3;d++){f=parseInt(e.substr(d*2,2),16);f=Math.round(Math.min(Math.max(0,f+(f*a)),255)).toString(16);b+=("00"+f).substr(f.length)}}return b};