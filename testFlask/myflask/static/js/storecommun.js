(function(e){var t=/^(?:auto|\d+(?:%|px))?$/;var h=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/aggregator.png",new google.maps.Size(31,31));var i="errorMessageSearchLabel";window.storeDetailedMap=null;window.storeMap=null;window.MAP_HEIGHT_SMARTPHONE=200;var m=window.IMAGE_PIN_STORE=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/pictogrammes/storeMarkerDef.png",new google.maps.Size(37,34));var s=window.IMAGE_PIN_STORE_PRODUCT_AVAILABLE=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/pictogrammes/storeMarkerProductIsAvailable.png",new google.maps.Size(29,38));var j=window.IMAGE_PIN_STORE_PRODUCT_NOT_AVAILABLE=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/pictogrammes/storeMarkerProductIsNotAvailable.png",new google.maps.Size(29,38));var r=window.IMAGE_PIN_STORE_INFORMATION_NOT_AVAILABLE=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/pictogrammes/storeMarkerInformationIsNotAvailable.png",new google.maps.Size(29,38));var k=window.IMAGE_PIN_FLAGSHIP=new google.maps.MarkerImage(CONFIGURATION.TECH_ASSETS_PATH+"store/pictogrammes/flagshipMarkerDef.png",new google.maps.Size(35,34));function a(){var v,u=e("#"+i),w=e("#"+ID_MAP_CANVAS);e("#expandMap").removeClass("expandMap").addClass("shrinkMap");e("#"+BOTTOM_BLOCK_ID).hide();e("#footer").hide();if(e(".header").hasClass("headerLeftOn")){e(".header").removeClass("headerLeftOn")}w.height(window.innerHeight-e(".header").height());setTimeout(function(){if(storeMap){google.maps.event.trigger(storeMap.mapStoreLocator,"resize");storeMap.handleStoreChangeEvent()}},100);if(u.is(":visible")){v=-e("#"+TOP_BLOCK_ID).outerHeight()+u.height()}else{v=-e("#"+TOP_BLOCK_ID).outerHeight()}w.css("margin-top",v);window.scrollTo(0,1);setTimeout(function(){if(!c()){a()}},1000);google.maps.event.trigger(window,"resize",{})}function o(){e("#"+ID_MAP_CANVAS).height(MAP_HEIGHT_SMARTPHONE).css("margin-top","0px");setTimeout(function(){if(storeMap){google.maps.event.trigger(storeMap.mapStoreLocator,"resize")}},100);e("#"+BOTTOM_BLOCK_ID).show();e("#footer").show();e("#expandMap").addClass("expandMap").removeClass("shrinkMap")}function p(){if(!RESPONSIVE_MANAGER.isAllSmallMode()){return}if(!c()){a()}else{o()}}function q(){e("<div/>").attr("id","expandMap").addClass("expandMap").on("click",function(){p()}).appendTo("#"+ID_MAP_CANVAS)}function c(){var u=e("#expandMap");return u.length>0&&!u.hasClass("expandMap")}function f(x,w){var v=e("<div>").html(x).attr("id","contentInfoWindowFake").css({position:"absolute",left:-1000}).appendTo(".page").addClass("storeBubble").width(w);var u=v.height();v.remove();return u}function n(u){if(!RESPONSIVE_MANAGER.isAllSmallMode()&&u=="#storeList a"){e(u).on("click",function(){e(".page").hide();setTimeout(function(){e(".page").show()},1000)})}}function g(){return e("#searchStoreInput")}function b(u){if("index" in u){u.index=Number(u.index)}if("latitude" in u){u.latitude=Number(u.latitude)}if("longitude" in u){u.longitude=Number(u.longitude)}if("callCenter" in u){u.callCenter=u.callCenter==="true"||u.callCenter===true}if("flagship" in u){u.flagship=u.flagship==="true"||u.flagship===true}return u}function d(u){if(!u||!u.canvas||(typeof u!=="string"&&typeof u!=="object")){throw new Error("A canvas ID is required to set up a map.")}this.markers=[];this.canvas=e("#"+u.canvas||u);this.ggMap=new google.maps.Map(this.canvas[0],{zoom:u.zoom||12,panControl:!is_touch_device(),streetViewControl:!is_touch_device(),zoomControl:!is_touch_device(),mapTypeControl:false,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(u.latitude||window.LATITUDE_HOME||0,u.longitude||window.LONGITUDE_HOME||0)});this.infoBubble=new InfoBubble({shadowStyle:1,padding:RESPONSIVE_MANAGER.isAllSmallMode()?5:20,borderRadius:1,borderWidth:0,arrowSize:10,minHeight:0,maxHeight:this.canvas.height()-40,maxWidth:this.canvas.width()-40,minWidth:0,disableAnimation:true,disableAutoPan:false,hideCloseButton:false,arrowPosition:50,backgroundClassName:"storeBubble",arrowStyle:0})}d.prototype.on=function(v,u){google.maps.event.addListener(this.ggMap,v,u);return this};d.prototype.off=function(u){google.maps.event.clearListeners(this.ggMap,u);return this};d.prototype.refresh=function(){google.maps.event.trigger(this.ggMap,"resize");return this};d.prototype.infoBubbleSize=function(u){var v=this.infoBubble.get("padding");if(u){if(u.padding===+u.padding){v=u.padding;this.infoBubble.setPadding(u.padding)}if(u.width===+u.width){this.infoBubble.setMaxWidth(u.width+v*2+20);this.infoBubble.setMinWidth(u.width+v*2+20)}if(u.height===+u.height){this.infoBubble.setMaxHeight(u.height+v*2);this.infoBubble.setMinHeight(u.height+v*2)}}return{padding:this.infoBubble.get("padding"),width:this.infoBubble.get("minWidth"),height:this.infoBubble.get("minHeight")}};d.prototype.size=function(v){if(v){if((v.width===+v.width&&v.width>=0)||t.test(v.width)){this.canvas.width(v.width)}if((v.height===+v.height&&v.height>=0)||t.test(v.height)){this.canvas.height(v.height)}}var u=this.canvas.width();var x=this.canvas.height();if(v){this.infoBubble.setMaxWidth(Math.max(0,u-20));this.infoBubble.setMaxHeight(Math.max(0,x-40));this.refresh()}return{width:u,height:x}};d.prototype.zoom=function(u){if(u===+u){this.ggMap.setZoom(Math.max(0,Math.min(180,u)))}return this.ggMap.getZoom()};d.prototype.center=function(u,v){if(u){this.ggMap[v?"setCenter":"panTo"]({lat:u.latitude,lng:u.longitude})}var w=this.ggMap.getCenter();return{latitude:w.lat(),longitude:w.lng()}};d.prototype.bounds=function(v){if(v){v=new google.maps.LatLngBounds(new google.maps.LatLng(v.south,v.west),new google.maps.LatLng(v.north,v.east));this.ggMap.fitBounds(v);this.ggMap.setCenter(v.getCenter())}var w=this.ggMap.getBounds();if(!w){return{north:90,east:180,south:-90,west:-180}}var x=w.getNorthEast();var u=w.getSouthWest();return{north:x.lat(),east:x.lng(),south:u.lat(),west:u.lng()}};d.prototype.isVisibile=function(){return this.canvas.is(":visible")};d.prototype.addMarkers=function(w,v){v=v||{};this.clearMarkers();var u=(function(z,y){var A=y.flagship===true?k:y.flagship===false?m:h;var x=new google.maps.Marker({map:this.ggMap,icon:A,title:y.name,animation:v.animation!==false?google.maps.Animation.DROP:undefined,position:{lat:y.latitude,lng:y.longitude}});google.maps.event.addListener(x,"click",function(){e(x.getMap().getDiv()).trigger("marker.click",[x,y])});x.unchangedposition={latitude:y.latitude,longitude:y.longitude};this.markers.push(x)}).bind(this);if(w&&w.aggregator){e.each(w.aggregator,u)}if(w&&w.stores){e.each(w.stores,u)}if(v.position){this.markers.push(new google.maps.Marker({map:this.ggMap,position:{lat:v.position.latitude,lng:v.position.longitude}}))}};d.prototype.clearMarkers=function(){e.each(this.markers,function(v,u){u.setMap(null)});this.markers=[]};d.prototype.getMarkerByPosition=function(u){var v=null;e.each(this.markers,function(x,w){if(u.latitude.toFixed(6)===w.unchangedposition.latitude.toFixed(6)&&u.longitude.toFixed(6)===w.unchangedposition.longitude.toFixed(6)){v=w;return false}});return v};function l(u){this.stores=[];this.aggregator=[];this._storageKey=String(u.storageKey);this.updateFromStorage(function(){if(this.stores.length===0&&homeStoreJson){this.stores=homeStoreJson.stores||[];this.aggregator=homeStoreJson.aggregator||[]}})}l.prototype.updateFromRemote=function(v){var u=e.Deferred();getAjax(false,"getStoreJson.jsp",(function(w){var x=e.parseJSON(w);this.stores=e.map(x.stores,b);this.aggregator=e.map(x.aggregator,b);u.resolve(this)}).bind(this),v,"",function(x,w){u.reject("Impossible to get getStoreJson.jsp: "+w)});return u.promise()};l.prototype.updateFromRemoteCN=function(v){var u=e.Deferred();getAjax(false,"getProvinceStoreJson.jsp",(function(w){var x=e.parseJSON(w);this.stores=e.map(x.stores,b);this.aggregator=e.map(x.aggregator,b);u.resolve(this)}).bind(this),v,"",function(x,w){u.reject("Impossible to get getStoreJson.jsp: "+w)});return u.promise()};l.prototype.updateFromStorage=function(){if(this._storageKey){var u=e.jStorage.get(this._storageKey);if(u&&u.stores){this.stores=u.stores}if(u&&u.aggregator){this.aggregator=u.aggregator}}};l.prototype.saveInStorage=function(u){if(u){if(this._storageKey){e.jStorage.deleteKey(this._storageKey)}this._storageKey=u}if(this._storageKey){e.jStorage.set(this._storageKey,{stores:this.stores,aggregator:this.aggregator})}};l.prototype.getStoreBy=function(v,w){var u=null;e.each(this.stores,function(x,y){if(y[v]===w||y.clickAndCollect[v]===w){u=y;return false}});return u};l.prototype.bounds=function(u){var v={north:-90,east:-180,south:90,west:180};function x(z,y){v.north=Math.max(v.north,y.latitude);v.south=Math.min(v.south,y.latitude);v.east=Math.max(v.east,y.longitude);v.west=Math.min(v.west,y.longitude)}e.each(this.stores,x);e.each(this.aggregator,x);if(u.position){x(undefined,u.position)}var w=0.1;return{north:Math.min(90,v.north+(v.north-v.south)*w),east:Math.min(180,v.east+(v.east-v.west)*w),south:Math.max(-90,v.south-(v.north-v.south)*w),west:Math.max(-180,v.west-(v.east-v.west)*w)}};l.prototype.empty=function(){this.stores=[];this.aggregator=[]};window.addExpandMapButton=q;window.isMapExpanded=c;window.getHeightBeforeRender=f;window.bindRemovePage=n;window.getInputTextElement=g;window.LVM=e.extend(window.LVM||{},{store:{List:l,Map:d}})})(jQuery);